<!doctype html>
<html lang="en">
<head>
    <title></title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
    <style type="text/css">
        * {
    font-family: 'Open Sans', sans-serif;
}

a, a:hover, footer .fa {
    color: #E99749;
}

a.icon {
    text-decoration: none;
}

pre {
    padding: 5px;
    border: 2px solid #E99749;
    background: #F8F9FA;
}

pre code {
    font-family: 'Courier', sans-serif;
    font-size: 0.9em;
}


.nav-link {
    padding: 0;
    margin: 0;
}

.sidebar p {
    padding: 0;
    margin: 0;
}

img.img-fluid {
    max-width: 500px;
}
    </style>
</head>
<body>
<div class="d-flex flex-column flex-md-row align-items-center p-3 px-md-4 mb-3 bg-white border-bottom shadow-sm">
    <h5 class="my-0 mr-md-auto font-weight-normal">
        <img src="https://avatars0.githubusercontent.com/u/710363?s=45&v=4" alt="Novactive"/>
        Nova eZ Platform Bundles
    </h5>
    <ul class="navbar-nav mr-auto">
        <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="" id="components-menu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Bundles
            </a>
            <div class="dropdown-menu" aria-labelledby="components-menu">

                                    <a class="dropdown-item" href="/Nova-eZPlatform-Bundles/master/2FABundle/README.md.html">2FABundle</a>
                                    <a class="dropdown-item" href="/Nova-eZPlatform-Bundles/master/Accelerator/README.md.html">Accelerator</a>
                                    <a class="dropdown-item" href="/Nova-eZPlatform-Bundles/master/AlgoliaSearchEngine/README.md.html">AlgoliaSearchEngine</a>
                                    <a class="dropdown-item" href="/Nova-eZPlatform-Bundles/master/CloudinaryBundle/README.md.html">CloudinaryBundle</a>
                                    <a class="dropdown-item" href="/Nova-eZPlatform-Bundles/master/EditHelpBundle/README.md.html">EditHelpBundle</a>
                                    <a class="dropdown-item" href="/Nova-eZPlatform-Bundles/master/EnhancedImageAssetBundle/README.md.html">EnhancedImageAssetBundle</a>
                                    <a class="dropdown-item" href="/Nova-eZPlatform-Bundles/master/ExtraBundle/README.md.html">ExtraBundle</a>
                                    <a class="dropdown-item" href="/Nova-eZPlatform-Bundles/master/FastlyImageOptimizerBundle/README.md.html">FastlyImageOptimizerBundle</a>
                                    <a class="dropdown-item" href="/Nova-eZPlatform-Bundles/master/LdapAuthenticatorBundle/README.md.html">LdapAuthenticatorBundle</a>
                                    <a class="dropdown-item" href="/Nova-eZPlatform-Bundles/master/MailingBundle/README.md.html">MailingBundle</a>
                                    <a class="dropdown-item" href="/Nova-eZPlatform-Bundles/master/MaintenanceBundle/README.md.html">MaintenanceBundle</a>
                                    <a class="dropdown-item" href="/Nova-eZPlatform-Bundles/master/MenuManagerBundle/README.md.html">MenuManagerBundle</a>
                                    <a class="dropdown-item" href="/Nova-eZPlatform-Bundles/master/ProtectedContentBundle/README.md.html">ProtectedContentBundle</a>
                                    <a class="dropdown-item" href="/Nova-eZPlatform-Bundles/master/ResponsiveImagesBundle/README.md.html">ResponsiveImagesBundle</a>
                                    <a class="dropdown-item" href="/Nova-eZPlatform-Bundles/master/RssFeedBundle/README.md.html">RssFeedBundle</a>
                                    <a class="dropdown-item" href="/Nova-eZPlatform-Bundles/master/SEOBundle/README.md.html">SEOBundle</a>
                                    <a class="dropdown-item" href="/Nova-eZPlatform-Bundles/master/SlackBundle/README.md.html">SlackBundle</a>
                                    <a class="dropdown-item" href="/Nova-eZPlatform-Bundles/master/SolrSearchExtraBundle/README.md.html">SolrSearchExtraBundle</a>
                                    <a class="dropdown-item" href="/Nova-eZPlatform-Bundles/master/StaticTemplatesBundle/README.md.html">StaticTemplatesBundle</a>
                            </div>
        </li>
    </ul>
    <nav class="my-2 my-md-0 mr-md-3">
        <a class="p-2 text-dark" target="_blank" href="https://almaviacx.com/expertises/web-mobile/">France</a>
        <a class="p-2 text-dark" target="_blank" href="https://www.nextedia.com">Nextedia</a>
        <a class="p-2 text-dark icon" target="_blank" href="https://github.com/Novactive/Nova-eZPlatform-Bundles"><i class="fab fa-github fa-2x" aria-hidden="true"></i>&nbsp;&nbsp;</a>
    </nav>
</div>

<div class="container-fluid">
        <div class="row flex-column-reverse flex-md-row">
        <div class="col-md-8 col-sm-12">
            <h1 name="debdd874b0ca5f09e56e58171cdd2d78">Novactive eZ Algolia Search Engine Bundle</h1>
<hr />
<p>Novactive eZ Algolia Search Engine is an eZ Platform bundle to provide Algolia search integration, enabling you to use the Algolia Search Engine to index the data and to search.</p>
<p>Thanks to these 3 main features:</p>
<ul>
<li><strong>eZ Repository Search Service Handler implementation</strong>: All basic use cases that are used by eZ Platform to retrieve the contents and locations
are managed by this bundle behind the scene thanks to the Repository Search Service.
This bunble implements all the visitors that enable the conversion from eZ Query instance (including Criterions, Sort Clauses, Facet Builders) into the request that is sent to Algolia.</li>
<li><strong>Algolia PHP Client integration</strong>: Content items are automatically indexed and you can execute Algolia queries directly bypassing the SearchService if you need to. Option is possible to hydrate results into <code>Content</code> or <code>Location</code> if needed.</li>
<li><strong>Algolia Front End</strong>: One of the many Algolia's benefits is the Frontend Components they provide to execute/implement the search using Front End technologies. Simplifying development and providing insane performances.
This bundle provides an example of that integration with React JS, with no style, and with Twitter Bootstrap. </li>
</ul>
<h2 name="7cd8fb6e31cc946c078d2740c76a9899">Installation</h2>
<h3 name="5a2ebfb8baa378cfcfcba58bbb1380c2">Requirements</h3>
<ul>
<li>eZ Platform 3.1+</li>
<li>PHP 7.3</li>
</ul>
<h3 name="fa9f2b3fde8a1ecd921517ebbf88a4fb">Installation steps</h3>
<p>Add the following to your composer.json and run <code>composer update novactive/ezalgoliasearchengine</code> to install dependencies:</p>
<pre><code class=" json"># composer.json

"require": {
    "novactive/ezalgoliasearchengine": "^1.0.0"
}</code></pre>
<h3 name="d69e5b7f86bb7173b050b7feb920e0cd">Javascript dependencies</h3>
<pre><code class=" bash">cd ezplatform
yarn add --dev algoliasearch react react-collapsible react-dom react-instantsearch-dom</code></pre>
<h3 name="040da9acc61145e551bcf66b54f44420">Register the bundle</h3>
<p>If Symfony Flex did not do it already, activate the bundle in <code>config\bundles.php</code> file.</p>
<pre><code class=" php">// config\bundles.php

return [
    Symfony\Bundle\FrameworkBundle\FrameworkBundle::class =&gt; ['all' =&gt; true],
    ...
    Novactive\Bundle\eZAlgoliaSearchEngine\NovaEzAlgoliaSearchEngine::class =&gt; ['all' =&gt; true],
];</code></pre>
<h3 name="814b1401d1a609253b98ac549a68a493">Add routes</h3>
<pre><code class=" yaml">_novaezalgoliasearchengine_routes:
    resource: '@NovaEzAlgoliaSearchEngine/Resources/config/routing.yaml'</code></pre>
<h3 name="3f4bf4386412c21921a20a87658ab387">ENV variables</h3>
<p>The <code>SEARCH_ENGINE</code> environment variable  should be set to <code>algolia</code></p>
<h3 name="254f642527b45bc260048e30704edb39">Configuration</h3>
<pre><code class=" yaml">nova_ezalgoliasearchengine:
    system:
        default:
            index_name_prefix: PREFIX
            app_id: APPLICATION_ID
            api_secret_key: ADMIN_API_KEY
            api_search_only_key: SEARCH_ONLY_PAI_KEY
            license_key: "CONTACT NOVACTIVE: direction.technique@novactive.com to get your trial"

webpack_encore:
    builds:
        nova_ezalgolia: "%kernel.project_dir%/public/assets/nova_ezalgolia/build"

framework:
    assets:
        packages:
            nova_ezalgolia:
                json_manifest_path: '%kernel.project_dir%/public/assets/nova_ezalgolia/build/manifest.json'
</code></pre>
<blockquote>
<p>The Algolia Application should be created on <a href="https://www.algolia.com/">https://www.algolia.com/</a> to retrieve the Application ID and the API secret keys. They can be found on the <strong>API Keys</strong> page of the Algolia dashboard.</p>
</blockquote>
<p>After having installed the package the following command should be run to init the Indexes on Algolia and set up the search attributes, sort indexes and facets:</p>
<pre><code class=" bash">bin/console nova:ez:algolia:indexes:setup</code></pre>
<h2 name="c64518704ce0c0d5501a45763f464276">Usage</h2>
<h3 name="b1fa27b52e581b95c61a2b4a072c965d">Query Criterions</h3>
<p>All the Criterions created inside the eZ Queries as a filter or query field are transformed into the Algolia filter string like </p>
<p><code>doc_type_s:content AND (content_type_identifier_s:"article")</code></p>
<h4 name="2c15022ea076738fb83f15400ecbe608">Limitations on Criterions</h4>
<p>A few of the main <a href="https://doc.ezplatform.com/en/master/guide/search/search_criteria_reference/">Criterions</a> are not implemented yet:</p>
<ul>
<li>Sibling (coming soon)</li>
<li>ObjectStateIdentifier (coming soon)</li>
<li>UserEmail (coming soon)</li>
<li>UserId (coming soon)</li>
<li>UserLogin (coming soon)</li>
<li>IsUserBased (coming soon)</li>
<li>IsUserEnabled (coming soon)</li>
<li>MapLocationDistance</li>
</ul>
<p>The User related criterions are not implemented yet because most of them are either included in the UserMetaData Criterion.</p>
<p>The <strong>MapLocationDistance</strong> Criterion is not implemented because the Algolia geo location filter option doesn't allow uss to manage multiple fields of this type within the same document.
Filtering by location can be done using the specific request options of the Algolia Search method.
Here is the example:</p>
<pre><code class=" php">    $query-&gt;setRequestOption('aroundLatLng', '37.7512306, -122.4584587');
    $query-&gt;setRequestOption('aroundRadius', 3000);</code></pre>
<blockquote>
<p>The documentation on this subject can be found <a href="https://www.algolia.com/doc/guides/managing-results/refine-results/geolocation/how-to/filter-results-around-a-location/">here</a>.</p>
</blockquote>
<p>The <strong>_geoloc</strong> attribute is already included in the Algolia document by default for the contents that have the Map Location fields.</p>
<p>Another constraints are inside the Logical operators. They are:</p>
<ul>
<li><em>FullText</em> Criterion cannot be inside <em>LogicalNot</em> or LogicalOr operator because it's moved to the Algoalia's query string request. Algolia works this way.</li>
<li><em>AND</em> operator cannot be inside <em>LogicalNot</em> criterion;</li>
<li><em>AND/OR</em> operator cannot be inside <em>LogicalOr</em> criterion.</li>
</ul>
<p>You can find more info on the specific boolean filters on Algolia documentation <a href="https://www.algolia.com/doc/api-reference/api-parameters/filters/#boolean-operators">here</a>.</p>
<p>The full Algolia information about how the filtering works can be found <a href="https://www.algolia.com/doc/api-reference/api-parameters/filters/">here</a>.</p>
<h3 name="2808a34767e19b842d906ab8ab6264c6">Sorting</h3>
<p>Sorting with Algolia is based on top of Replicas. Each Replica is a duplicated index with specific configuration on attributes on which the documents are sorted.
The attributes that are used to generate the Replicas can be set in the <code>attributes_for_replicas</code> config parameter.</p>
<p>When using the eZ Query the <strong>sortClauses</strong> field assigned to the Query instance is converted into the Replica key.</p>
<h3 name="c4ce5d21960dffa454bcb706d27bb29c">Reindexing</h3>
<p>All the data (Content and Location items) are pushed to the Algolia Index using the <code>bin/console ezplatform:reindex</code> command.
All of them (except those specified in _exclude_content<em>types</em> parameter or only those included in _include_content<em>types</em> parameter)
are converted to a specific format and sent to Algolia via saveObjects method.
Also each particular Content of allowed Content Type (included or not excluded) is pushed to the Index once published on Ez Platform admin dashboard.</p>
<h3 name="269930f5861e06f390788fd762d7a115">Front End Implementation</h3>
<p>The Search page with <code>/search</code> url is overridden with custom Search controller implemented in the Bundle.
The specific routing configuration is used for that:</p>
<pre><code class=" yaml">ezplatform.search:
    path: /search
    methods: ['GET']
    defaults:
        _controller: 'Novactive\Bundle\eZAlgoliaSearchEngine\Controller\SearchController::searchAction'</code></pre>
<p>The source code of the Front End implementation with React components can be found in the <a href="bundle/Resources/assets/js/search.jsx"><code>search.jsx</code></a> file.
All the main widgets are included there and can be used as examples of their implementation.
The information on React InstantSearch component basic installation and widgets showcases can be also found in the docs:</p>
<ul>
<li><a href="https://www.algolia.com/doc/guides/building-search-ui/installation/react/">React search installation</a></li>
<li><a href="https://www.algolia.com/doc/guides/building-search-ui/widgets/showcase/react/">React Search Widgets</a></li>
</ul>
<h3 name="2d3dc2a8d266c55a1864348f4ea58c78">Security Notes</h3>
<p>To restrict the scope of an API key the Secured API keys are used.
The Secured API key can be only generated from Search-only API key from the Algolia API keys list.
This kind of API key is used when performing the Search method and to prevent possible malicious request tweaks to impersonate another user, so it's done on the Back End side. </p>
<p>In other words, based on the currernt User Permissions, this bundle queries Algolia including permission-related implicit filters to avoid data leaks.</p>
<p>More info <a href="https://www.algolia.com/doc/guides/security/api-keys/how-to/user-restricted-access-to-data/?language=php">here</a>.</p>
<blockquote>
<p>When performing the saveObjects method to create, update or delete the entries of the Ined the Admin API key is used.</p>
</blockquote>
<h3 name="37b027d2e19ba7225eab56ecabf9d8fc">Advanced Usage</h3>
<h4 name="87b72324f64a85031dbdcc064b785d2b">Exclude/Include Content Types from indexation</h4>
<p>You can select which Content Types to include or exclude from the Index.
Use the following config parameters to exclude or include the specific content types:</p>
<ul>
<li><code>nova_ezalgoliasearchengine.default.exclude_content_types</code></li>
<li><code>nova_ezalgoliasearchengine.default.include_content_types</code></li>
</ul>
<p>The <code>include</code> parameter is checked first and hence has the priority.
By default all the content types are saved to the Index except <strong>User</strong> and <strong>User Group</strong>.</p>
<p>There are also the following parameters:</p>
<ul>
<li>Searchable Attributes;</li>
<li>Attributes for Faceting;</li>
<li>Attributes to Retrieve;</li>
<li>Attributes for Replicas (used for sorting);</li>
</ul>
<p>You can see the default list of the attributes that are sent to Algolia in the
<a href="https://github.com/Novactive/NovaeZAlgoliaSearchEngine/blob/master/bundle/Resources/config/default_settings.yaml">Deafult Settings</a>.</p>
<p>To send all those setting to Algolia use the <code>bin/console nova:ez:algolia:indexes:setup</code> command.</p>
<h4 name="d274179959d7996a4de68dfe8d7abb12">Using the Query Factory to generate the custom queries</h4>
<p>If you want to create more specific custom request that can be achieved with the Search Query Factory service
<a href="https://github.com/Novactive/NovaeZAlgoliaSearchEngine/blob/master/bundle/Core/Search/SearchQueryFactory.php"><code>Novactive\Bundle\eZAlgoliaSearchEngine\Core\Search\SearchQueryFactory</code></a>.
When using it all the request parameters should be specified manually, i.e search term, filters, facets etc. like in the following example:</p>
<pre><code class=" php">    $query = $this-&gt;searchQueryFactory-&gt;create(
        'term',
        'content_type_identifier_s:"article"',
        ['doc_type_s']
    );
    $query-&gt;setRequestOption('attributesToRetrieve', ['content_name_s']);</code></pre>
<p>The Replica can be also specified manually:</p>
<pre><code class=" php">    $query = $this-&gt;searchQueryFactory-&gt;create(
        '',
        'content_language_codes_ms:"eng-GB"',
    );
    $query-&gt;setReplicaByAttribute('location_id_i');</code></pre>
<p>Then the created Query instance should be passed to one of the methods of
<a href="bundle/Core/Search/Search.php"><code>Novactive\Bundle\eZAlgoliaSearchEngine\Core\Search\Search</code></a> service depending on the type of search:</p>
<ul>
<li>findContents</li>
<li>findLocations</li>
<li>find (for the raw search).</li>
</ul>
<blockquote>
<p>There is also an event that enables you to tweak the <code>Query</code> created by the factory. <code>Novactive\Bundle\eZAlgoliaSearchEngine\Event\QueryCreateEvent</code> </p>
</blockquote>

            <p class="text-right">
                <img width="204" height="20"
                     src='https://img.shields.io/badge/Updated on-07--17--2023 14:27:48-green?style=flat-square&labelColor=black'
                     alt='Updated on 07--17--2023 14:27:48'
                />
            </p>
        </div>
        <div class="col-md-4 col-sm-12 d-print-none sidebar">
                            <p><strong>In this page</strong>:</p>
                <ul class="nav flex-column"><li class="nav-item first last"><a href="#debdd874b0ca5f09e56e58171cdd2d78" class="nav-link">Novactive eZ Algolia Search Engine Bundle</a><ul class="menu_level_1"><li class="nav-item first"><a href="#7cd8fb6e31cc946c078d2740c76a9899" class="nav-link">Installation</a><ul class="menu_level_2"><li class="nav-item first"><a href="#5a2ebfb8baa378cfcfcba58bbb1380c2" class="nav-link">Requirements</a></li><li class="nav-item"><a href="#fa9f2b3fde8a1ecd921517ebbf88a4fb" class="nav-link">Installation steps</a></li><li class="nav-item"><a href="#d69e5b7f86bb7173b050b7feb920e0cd" class="nav-link">Javascript dependencies</a></li><li class="nav-item"><a href="#040da9acc61145e551bcf66b54f44420" class="nav-link">Register the bundle</a></li><li class="nav-item"><a href="#814b1401d1a609253b98ac549a68a493" class="nav-link">Add routes</a></li><li class="nav-item"><a href="#3f4bf4386412c21921a20a87658ab387" class="nav-link">ENV variables</a></li><li class="nav-item last"><a href="#254f642527b45bc260048e30704edb39" class="nav-link">Configuration</a></li></ul></li><li class="nav-item last"><a href="#c64518704ce0c0d5501a45763f464276" class="nav-link">Usage</a><ul class="menu_level_2"><li class="nav-item first"><a href="#b1fa27b52e581b95c61a2b4a072c965d" class="nav-link">Query Criterions</a><ul class="menu_level_3"><li class="nav-item first last"><a href="#2c15022ea076738fb83f15400ecbe608" class="nav-link">Limitations on Criterions</a></li></ul></li><li class="nav-item"><a href="#2808a34767e19b842d906ab8ab6264c6" class="nav-link">Sorting</a></li><li class="nav-item"><a href="#c4ce5d21960dffa454bcb706d27bb29c" class="nav-link">Reindexing</a></li><li class="nav-item"><a href="#269930f5861e06f390788fd762d7a115" class="nav-link">Front End Implementation</a></li><li class="nav-item"><a href="#2d3dc2a8d266c55a1864348f4ea58c78" class="nav-link">Security Notes</a></li><li class="nav-item last"><a href="#37b027d2e19ba7225eab56ecabf9d8fc" class="nav-link">Advanced Usage</a><ul class="menu_level_3"><li class="nav-item first"><a href="#87b72324f64a85031dbdcc064b785d2b" class="nav-link">Exclude/Include Content Types from indexation</a></li><li class="nav-item last"><a href="#d274179959d7996a4de68dfe8d7abb12" class="nav-link">Using the Query Factory to generate the custom queries</a></li></ul></li></ul></li></ul></li></ul>
                    </div>
    </div>
    <footer class="pt-4 my-md-5 pt-md-5 border-top">
    <div class="row">
        <div class="col-2">
            <img class="mb-2" src="https://avatars0.githubusercontent.com/u/710363?s=60&v=4" width="24" height="24" alt="Novactive"/>
            <small class="d-block mb-3 text-muted">&copy; 2023</small>
        </div>
        <div class="col-8">
            <p class="text-center">
                <i class="fas fa-code"></i> with
                <i class="fas fa-heart"></i> in Paris, Toulon, Nantes, Bordeaux and California.
            </p>
        </div>
        <div class="col-2">
            <p class="text-right">
                <a href="#">
                    Back to top
                </a>
            </p>
        </div>
    </div>
</footer>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>

<link rel="stylesheet"  href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/styles/github.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/highlight.min.js"></script>

<script type="text/javascript">
    $(function () {
        function _scrollToName (hash) {
            var name = hash.substr(1);
            var to = (name === '') ? 0 : $("[name=" + name + "]").offset().top - 10;
            $('html, body').animate({
                scrollTop: to
            }, 'slow');
        }

        $('a[href^="#"]').click(function () {
            var selector = $(this).attr("href");
            _scrollToName(selector);
            return false;
        });

        if (location.hash) {
            _scrollToName(location.hash);
        }
    });
    hljs.initHighlightingOnLoad();
</script>
</body>
</html>
